# 使用 arcgis pro 机器学习提取建筑物轮廓



1. 经常看到那些搞机器学习的人，往群里扔一张下面这样的图，然后就有人回复哇好牛哇，怎么做到的。而自己在边上瞅着一脸懵逼，不知道他们在说啥。
   ![下降图](E:\Users\HERO\Desktop\自动提取建筑物\下降图.png)
2. 机器学习在GIS领域的应用目前主要是影像的提取和分类
3. arcgis pro 已经将机器学习封装到了非常便捷的地步，基本上只看arcgis的帮助，没有机器学习的基础也能很好的使用。
4. 我们的目标是用开源库实现建筑物轮廓的提取，所以要知其然还要知其所以然。
5. 这篇文章的目的是让完全不懂机器学习的GISer，看完后对机器学习有个大概的认识，并且能够通过 arcgis pro 实现建筑物轮廓提取。

## ArcGIS Pro 提取建筑物轮廓

这是一篇操作教程，介绍如何使用ArcGIS Pro 软件从影像地图中提取建筑物轮廓数据，影像数据使用水经注软件中的免费功能下载，矢量数据使用jsom+arcgis osm，使用北航的数据进行训练模型，用模型去提取北科大的建筑物轮廓。

软件准备

1. ArcGIS pro 安装，建议为2.7以上版本。
2. ArcGIS pro 通过临时邮箱获得2个月试用，参考链接：https://zhuanlan.zhihu.com/p/339358962
3. ArcGIS pro 安装机器学习模块，参考链接：https://mp.weixin.qq.com/s/N3glECjvMijuDmNYOLqrQQ
4. josm 安装
5. arcgis OSM 插件

数据准备

1. 影像数据（通过水经注下载）

2. 1. 下载北航的影像

      ![下载北航影像1](E:\Users\HERO\Desktop\自动提取建筑物\下载北航影像1.png)

      ![下载北航影像2](E:\Users\HERO\Desktop\自动提取建筑物\下载北航影像2.png)
      
      

3. 矢量数据

4. 1. JOSM下载数据

      ![jsom下载数据](E:\Users\HERO\Desktop\自动提取建筑物\jsom下载数据.png)

   2. 保存地图

      ![保存地图](E:\Users\HERO\Desktop\自动提取建筑物\保存地图.png)

   3. 将osm格式数据转换为shp。使用arcmap，确认arcmap上已经安装了OSM插件。

      ![OSM插件](E:\Users\HERO\Desktop\自动提取建筑物\OSM插件.png)

   4. ![导出建筑物数据1](E:\Users\HERO\Desktop\自动提取建筑物\导出建筑物数据1.png)

   5. 

      ![导出建筑物数据2](E:\Users\HERO\Desktop\自动提取建筑物\导出建筑物数据2.png)

生成训练数据

![生成训练数据](E:\Users\HERO\Desktop\自动提取建筑物\生成训练数据.png)

![生成训练数据2](E:\Users\HERO\Desktop\自动提取建筑物\生成训练数据2.png)

![生成训练数据3](E:\Users\HERO\Desktop\自动提取建筑物\生成训练数据3.jpg)

![生成训练数据4](E:\Users\HERO\Desktop\自动提取建筑物\生成训练数据4.png)

训练模型

![训练模型1](E:\Users\HERO\Desktop\自动提取建筑物\训练模型1.png)

![训练模型2](E:\Users\HERO\Desktop\自动提取建筑物\训练模型2.png)

![训练模型3](E:\Users\HERO\Desktop\自动提取建筑物\训练模型3.jpg)

![训练模型4](E:\Users\HERO\Desktop\自动提取建筑物\训练模型4.png)

![训练模型5](E:\Users\HERO\Desktop\自动提取建筑物\训练模型5.png)

下载北科大影像，方法和上面下载北航的相同。

模型应用，提取建筑物轮廓

![提取建筑物轮廓](E:\Users\HERO\Desktop\自动提取建筑物\提取建筑物轮廓.png)

![提取建筑物轮廓2](E:\Users\HERO\Desktop\自动提取建筑物\提取建筑物轮廓2.png)

![提取建筑物轮廓3](E:\Users\HERO\Desktop\自动提取建筑物\提取建筑物轮廓3.png)

![提取建筑物轮廓4](E:\Users\HERO\Desktop\自动提取建筑物\提取建筑物轮廓4.png)

规则化数据

![规则化数据](E:\Users\HERO\Desktop\自动提取建筑物\规则化数据.png)

![规则化数据2](E:\Users\HERO\Desktop\自动提取建筑物\规则化数据2.png)

![规则化数据3](E:\Users\HERO\Desktop\自动提取建筑物\规则化数据3.png)

用提取的数据补充osm地图数据

1. 把提取的数据用geoserver发布成矢量瓦片
2. 用maputnik加载osm地图和我们自己提取建筑物地图，然后融合

## 原理分析

用业余时间学习了很久的机器学习原理，感觉自己都会了，信心满满的想借此机会好好给大家讲（xian）讲（bai），可真正要写时才发现，自己只是整明白了大概的原理，还有很多技术细节没有整明白。

我觉得我听懂了，其实不是我听懂了，而是人家讲明白了，这距离我有能力再给别人讲明白还差的很远很远。

而且就是里面的东西随便拿出来一个，都能单独写一篇文章，所以今天就只能给大家一个学习的路径图。

arcgis Pro 中能够提取建筑物轮廓的工具主要是实例分割模型、和语义分割模型，语义分割模型必须在建筑物之间分开一定距离时才能正确提取，不然会讲多个挨着的建筑物认为是一个。实例分割模型可以很好的解决这个问题。语义分割模型主要是UnetClassifier，实例分隔模型主要是MaskRCNN。上面的操作就是用的MaskRCNN

MaskRCNN的技术演进图是这样的

CNN -> R-CNN -> Fast-RCNN -> Faster-RCNN -> Mask-RCNN

详细介绍参考这篇：[https://imlogm.github.io/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/rcnn/](https://imlogm.github.io/深度学习/rcnn/)

我自己的感觉是，直接看MaskRCNN多半是看不明白的，需要从基础的CNN看起，

直接看CNN其实也是看不明白的，需要了解更基础的机器学习知识。

从零开始学习机器学习知识也有个前提，那就是得保证你在大学里学的微积分和线性代数知识还没有还给老师。

所以，就基于上述这些前提，来给大家推荐入门资料。

网上普遍推荐的课程有3个：李宏毅、吴恩达、李飞飞

我选择了看李宏毅的，因为他直接将中文（捂脸）。大家感兴趣的也可以看看另外两个

如果你只是想搞懂CNN的话，关于李宏毅的课程，只推荐学习前3节课，因为后面讲的和GIS的关系就不大了。

第一节 讲基础

第二节 讲

第三节 CNN

如果你的微积分和线性代数确定已经还给了老师，那我推荐你看一下下面这个课程

《吴军的数学通识50讲》，我自己听完以后的感觉是，如果我在上大学时听到了这个课程，我应该会对高数产生浓厚的兴趣，

这个课程在得到上，是付费的。但通过分享，有20个免费试听的名额，我把他们打包分享给大家。在公众号中回复数学获得。

如果你觉得老师讲的都太抽象，我这里还有一个宝贝，回形针《一个人工智能的诞生》，关于机器学习的交互视频，里面不光有形象的机器学习知识，还能动手操作。我的好多概念都是反复看了很多遍这个后才理解的。这个是付费的。

都说要有亮剑精神，既然都写到这里了，还是想把自己的理解和大家分享一下，可能会理解有误，大家辩证看待，或直接跳过，看最后的总结。

我们介绍一下基础中的基础，CNN，这个就像要自己开发一个微信前，要先搞懂Socket通信原理一样。

我自己对CNN的理解就是，通过训练收集图像特征，根据特征，判断概率，根据概率决定









推荐李宏毅的资料

https://www.bilibili.com/video/BV1Wv411h7kN?p=2

对深度学习的理解，类似猜商品价格的游戏，你报个价，对方告诉你高了，还是低了，然后就接着猜，直到你猜的值和真实价格很相近了为止。

深度学习像是一个团队在玩猜商品价格的游戏，这个团队更像一个公司，价格是根据员工的劳动时间乘上一个系数决定的，每个员工的价格反馈给自己的中层领导，中层领导手里也有一个调整系统的权利，中层领导调整后中，汇总加权后给老板，老板负责向客户报最终的价格，客户反馈给老板价格高了还是低了，老板在反馈给中层、中层再反馈给员工，员工根据反馈调整自己的权重，大家都去调整自己的权重，最终成交。

自己之前学习时写过的一篇文章，写完后觉得没入门的看不懂，入门的看着没有技术含量，就没有公开。

总结

1. osm地图在国内的数据相对较少，我们可以尝试用机器学习的方式从自己提取建筑物来完善数据。
2. arcgis pro 已经把和GIS相关的机器学习工具封装到了非常简单易用的程度，不懂机器学习知识，只看说明文档也能使用。
3. 样本数据可以通过下载免费影像地图和OSM数据来解决。
4. 提取数据的精度，和影像的倾斜角、楼层高度，样本标记的质量和数量有很大关系。如果真的想实现第一条，还有很长的路要走。
5. 提取的速度主要和机器性能有关系，核心是显卡。
6. 善用工具能让我们走的更快，搞懂原理能让我们走的更远。所以了解机器学习背后的原理同样很重要。